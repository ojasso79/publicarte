function insert_ticket_knowledgebase_link(t){var e=$(t).val();""!=e&&$.get(admin_url+"knowledge_base/get_article_by_id_ajax/"+e,function(e){$('textarea[name="message"]');tinymce.activeEditor.execCommand("mceInsertContent",!1,'<a href="'+site_url+"knowledge_base/"+e.slug+'">'+e.subject+"</a>"),$(t).selectpicker("val","")},"json")}function tickets_bulk_action(t){if(0==confirm(appLang.confirm_action_prompt))return!1;var e=$("#mass_delete").prop("checked"),a=[],n={};if(0==e||void 0===e){if(n.status=$("#move_to_status_tickets_bulk").val(),n.department=$("#move_to_department_tickets_bulk").val(),n.priority=$("#move_to_priority_tickets_bulk").val(),n.service=$("#move_to_service_tickets_bulk").val(),n.tags=$("#tags_bulk").tagit("assignedTags"),""==n.status&&""==n.department&&""==n.priority&&""==n.service&&""==n.tags)return}else n.mass_delete=!0;var i=$(".table-tickets").find("tbody tr");$.each(i,function(){var t=$($(this).find("td").eq(0)).find("input");1==t.prop("checked")&&a.push(t.val())}),n.ids=a,$(t).addClass("disabled"),setTimeout(function(){$.post(admin_url+"tickets/bulk_action",n).done(function(){window.location.reload()})},50)}$(function(){$("#insert_predefined_reply").on("change",function(t){t.preventDefault();var e=$(this),a=e.val();""!=a&&$.get(admin_url+"tickets/get_predefined_reply_ajax/"+a,function(t){tinymce.activeEditor.execCommand("mceInsertContent",!1,t.message),e.selectpicker("val","")},"json")}),$(".block-sender").on("click",function(){var t=$(this).data("sender");if(""==t)return alert("No Sender Found"),!1;$.post(admin_url+"tickets/block_sender",{sender:t}).done(function(){window.location.reload()})}),$(".add_note_ticket").on("click",function(t){t.preventDefault();var e=$('textarea[name="note_description"]').val(),a=$('input[name="ticketid"]').val();""!=e&&$.post(admin_url+"misc/add_note/"+a+"/ticket",{description:e}).done(function(){window.location.reload()})}),$(".save_changes_settings_single_ticket").on("click",function(t){t.preventDefault();var e={};e=$("#settings *").serialize(),e+="&ticketid="+$('input[name="ticketid"]').val(),$.post(admin_url+"tickets/update_single_ticket_settings",e).done(function(t){1==(t=JSON.parse(t)).success&&(void 0!==t.department_reassigned?window.location.href=admin_url+"tickets/":window.location.reload())})}),$('select[name="status_top"]').on("change",function(){var t=$(this).val(),e=$('input[name="ticketid"]').val();$.get(admin_url+"tickets/change_status_ajax/"+e+"/"+t,function(t){alert_float(t.alert,t.message)},"json")}),$('body.ticket select[name="contactid"]').on("change",function(){var t=$(this).val(),e=$('select[name="project_id"]'),a=e.html("").clone(),n=$(".projects-wrapper");e.selectpicker("destroy").remove(),e=a,$("#project_ajax_search_wrapper").append(a),init_ajax_search("project",e,{customer_id:function(){return $('input[name="userid"]').val()}}),""!=t?$.post(admin_url+"tickets/ticket_change_data/",{contact_id:t}).done(function(t){t=JSON.parse(t),$('input[name="to"]').val(t.contact_data.firstname+" "+t.contact_data.lastname),$('input[name="email"]').val(t.contact_data.email),$('input[name="userid"]').val(t.contact_data.userid),t.customer_has_projects?n.removeClass("hide"):n.addClass("hide")}):($('input[name="to"]').val(""),$('input[name="email"]').val(""),$('input[name="contactid"]').val(""),n.addClass("hide"))});var t=1;$(".add_more_attachments").on("click",function(){if($(this).hasClass("disabled"))return!1;if($('.attachments input[name*="attachments"]').length>=app_maximum_allowed_ticket_attachments)return!1;var e=$(".attachments").find(".attachment").eq(0).clone().appendTo(".attachments");e.find("input").removeAttr("aria-describedby"),e.find("input").removeAttr("aria-invalid"),e.find("input").attr("name","attachments["+t+"]").val(""),e.find('p[id*="error"]').remove(),e.find("i").removeClass("fa-plus").addClass("fa-minus"),e.find("button").removeClass("add_more_attachments").addClass("remove_attachment").removeClass("btn-success").addClass("btn-danger"),t++}),$("body").on("click",".remove_attachment",function(){$(this).parents(".attachment").remove()})});